// Copyright 2019 The Fuchsia Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

library fuchsia.auth.oldtokens;

/// The id of a user linked to this device, alongside the current access token
/// to make requests on the user's behalf.
table Credential {
  /// Opaque id for the user with which this credential is associated. It is
  /// stable across reconnections to the CredentialsProducer protocol.
  1: string user_id;

  /// OAuth2 access token for this user.
  2: string access_token;
};

/// Clients can connect to this protocol to subscribe to changes in the set of
/// users linked to this device, as well as the OAuth2 access token associated
/// with each.
///
/// This protocol won't be supported on the majority of devices, and shouldn't
/// be used without permission from its maintainers.
[Discoverable]
protocol CredentialsProducer {
  // Triggered when the set of linked users, or their corresponding access
  // tokens, has changed since the last time it triggered.
  //
  // Not triggered again until the client has acknowledged reception by
  // calling `NotifyEventHandled`.
  //
  // When the client connects to this protocol, it will always receive this
  // event once with the current set of credentials.
  -> OnCredentialsChanged(vector<Credential> credentials);

  // Acknowledges the client is ready to receive the next `OnCredentialsChanged`
  // event.
  NotifyEventHandled();
};
