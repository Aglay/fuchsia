#!/bin/bash
# Copyright 2017 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

### run bootserver in zedboot disk paver mode

## Before running the Zircon host tool `bootserver`, this command executes a
## build of `images/efi.blk` and `images/fvm.sparse.blk`.
## `bootserver` is then invoked with `zircon.bin`, the boot-minimal bootdata,
## and the two disk images for paving.

set -e

source "$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"/lib/image_build_vars.sh

fx-command-run build "${efi_block}" "${fvm_sparse_block}" "${ramdisk_bin}"

exec "${ZIRCON_TOOLS_DIR}/bootserver" --efi "${FUCHSIA_BUILD_DIR}/${efi_block}" \
  --fvm "${FUCHSIA_BUILD_DIR}/${fvm_sparse_block}" \
    "${ZIRCON_BUILD_DIR}/${zircon_bin}" \
    "${FUCHSIA_BUILD_DIR}/${ramdisk_bin}" "$@"