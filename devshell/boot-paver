#!/bin/bash
# Copyright 2017 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

set -e

source "$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"/lib/image_build_vars.sh

for f in "${fvm_sparse_block}" "${efi_block}" "${zircon_bin}" "${ramdisk_bin}" "${cmdline}"; do
  if [[ ! -s "$f" ]]; then
    echo >&2 "Required file \"$f\" is missing, run \"fx mkpaver\""
    exit 1
  fi
done

exec "${ZIRCON_TOOLS_DIR}/bootserver" --efi "${efi_block}" --fvm "${fvm_sparse_block}" \
  "${zircon_bin}" "${ramdisk_bin}" -- $(<"${cmdline}")