# Copyright 2021 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/dart/dart_component.gni")
import("//build/dart/dart_library.gni")
import("//build/dart/dart_test_component.gni")
import("//build/dart/fidl_move.gni")

dart_library("archive-reader") {
  null_safe = true
  package_name = "dart-archive-reader"
  source_dir = "lib"
  sources = [
    "reader.dart",
    "src/diagnostic_config.dart",
    "src/diagnostic_data.dart",
    "src/reader.dart",
  ]
  deps = [
    "//sdk/dart/zircon",
    "//sdk/fidl/fuchsia.diagnostics",
    "//sdk/fidl/fuchsia.mem",
    "//sdk/fidl/fuchsia.sys",
    dart_package_label.fuchsia_services,
  ]
}

dart_test_component("dart-archive-reader-test-component") {
  component_name = "dart-archive-reader-test"
  manifest = "meta/dart-archive-reader-test.cmx"
  sources = [ "reader_test.dart" ]
  deps = [
    ":archive-reader",
    "//sdk/fidl/fuchsia.diagnostics",
    "//sdk/fidl/fuchsia.sys",
    "//third_party/dart-pkg/pub/pedantic",
    "//third_party/dart-pkg/pub/test",
    dart_package_label.fuchsia_inspect,
    dart_package_label.fuchsia_services,
  ]
  options_file = "analysis_options.yaml"
}

fuchsia_test_package("dart-archive-reader-test") {
  package_name = "dart-archive-reader-test-package"
  test_components = [ ":dart-archive-reader-test-component" ]
  deps = [ "//src/lib/diagnostics/inspect/rust:inspect_test_component" ]
}

group("tests") {
  testonly = true
  deps = [ ":dart-archive-reader-test" ]
}
