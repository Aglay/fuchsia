# Copyright 2018 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/images/assemble_system.gni")
import("//build/unification/images/common_image_contents.gni")

assemble_system("guest") {
  base_packages = [
    "//garnet/bin/power_manager",
    "//garnet/bin/power_manager:base_config",
    "//garnet/bin/run",
    "//garnet/bin/sysmgr",
    "//garnet/bin/trace",
    "//garnet/bin/vsock_service:vsock_service",
    "//src/diagnostics/archivist",
    "//src/diagnostics/archivist:with_default_config",
    "//src/sys/appmgr",
    "//src/sys/appmgr:appmgr_scheme_config",
    "//src/sys/core",
    "//src/virtualization/packages/zircon_guest:services_config",
    "//src/virtualization/tests:virtualization_test_utils_pkg",
  ]
  bootfs_labels = common_image_contents
  bootfs_labels += [
    "//src/sys/component_manager:component_manager_config_bootfs_resource",
    "//src/connectivity/ethernet/drivers/virtio:virtio_ethernet",
    "//src/devices/block/drivers/virtio:virtio_block",
    "//src/devices/block/drivers/virtio:virtio_scsi",
    "//src/devices/misc/drivers/virtio-rng:virtio_rng",
    "//src/devices/misc/drivers/virtio-socket:virtio_socket",
    "//src/devices/serial/drivers/virtio-console:virtio_console",
    "//src/graphics/drivers/virtio:virtio_gpu",
    "//src/ui/input/drivers/virtio:virtio_input",
  ]
  if (current_cpu == "x64") {
    bootfs_labels += [
      "//src/connectivity/ethernet/drivers/realtek-8111",
      "//src/devices/block/drivers/ahci",
      "//src/devices/block/drivers/mbr",
      "//src/devices/block/drivers/nvme",
      "//src/devices/block/drivers/pci-sdhci",
      "//src/devices/block/drivers/sdhci",
      "//src/devices/board/drivers/x86:platform-bus-x86",
      "//src/devices/i2c/drivers/intel-i2c",
      "//src/devices/rtc/drivers/intel-rtc",
      "//src/devices/serial/drivers/intel-serialio",
      "//src/devices/serial/drivers/uart16550",
      "//src/devices/usb/drivers/xhci:xhci-x86",
      "//src/graphics/display/drivers/intel-i915",
      "//src/media/audio/drivers/alc5514",
      "//src/media/audio/drivers/alc5663",
      "//src/media/audio/drivers/intel-hda/codecs/hdmi:hdmi-audio-codec",
      "//src/media/audio/drivers/intel-hda/codecs/realtek:realtek-audio-codec",
      "//src/media/audio/drivers/intel-hda/controller:intel-hda",
      "//src/media/audio/drivers/max98927",
      "//src/ui/input/drivers/i2c-hid",
      "//src/ui/input/drivers/pc-ps2",
    ]
  }
  sysmgr_golden = "sysmgr-golden.json"
}
