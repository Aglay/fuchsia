# Copyright 2020 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

declare_args() {
  # Use this flag to exclude artifacts from Astro builds.
  # This is a very hacky way of ensuring that the resulting fuchsia.zbi fits
  # within the available space on device.
  # This will soon enough be replaced with a proper way to select image
  # artifacts based on board / product properties.
  # Artifacts that are known to not be useful on Astro builds (e.g. drivers for
  # other devices, tests) may be put in `if (!filter_out_of_astro)` blocks.
  # TODO(45680): remove this hack.
  filter_out_of_astro = false

  # Use this flag to include previously excluded artifacts on products based on
  # Astro.
  # Yes, our image building system is so broken that this is currently the only
  # way to accommodate the configurations we run on our infrastructure.
  on_second_thought_keep_on_astro = false
}

# This parameter contains runtime objects which go into most system zbi's.
# This list is the descendent of the "image" manifest file generated by the ZN,
# build and is mostly used by image targets under //build/images.
common_image_contents = [
  "//build/info:bootfs",
  "//bundles/drivers:usb-host-stack",
  "//src/bringup/bin/trace-benchmark",
  "//src/bringup/bundles:bootstrap",
  "//src/connectivity/bluetooth/hci/transport/uart:bt-transport-uart",
  "//src/connectivity/bluetooth/hci/vendor/broadcom:bt-hci-broadcom",
  "//src/connectivity/ethernet/drivers/ethernet",
  "//src/connectivity/ethernet/drivers/ethertap",
  "//src/connectivity/ethernet/drivers/rndis-function",
  "//src/connectivity/ethernet/drivers/usb-cdc-function",
  "//src/connectivity/network/bin/ping",
  "//src/connectivity/network/drivers/network-device",
  "//src/developer/cmd:bin",
  "//src/developer/forensics/crasher/cpp:crasher_exe",
  "//src/devices:bootfs",
  "//src/devices/bin/driver_manager:bootfs",
  "//src/devices/bin/driverctl",
  "//src/devices/bin/lsdev",
  "//src/devices/bin/tee-test",
  "//src/devices/bin/unbind",
  "//src/devices/block/bin/biotime",
  "//src/devices/block/bin/blktest",
  "//src/devices/block/bin/disk-inspect",
  "//src/devices/block/bin/fvm-check",
  "//src/devices/block/bin/gpt",
  "//src/devices/block/bin/iochk",
  "//src/devices/block/bin/iotime",
  "//src/devices/block/bin/lsblk",
  "//src/devices/block/bin/sdio",
  "//src/devices/block/drivers/aml-sd-emmc",
  "//src/devices/block/drivers/block-verity",
  "//src/devices/block/drivers/ftl",
  "//src/devices/block/drivers/fvm",
  "//src/devices/block/drivers/ramdisk",
  "//src/devices/block/drivers/ums-function",
  "//src/devices/block/drivers/zxcrypt",
  "//src/devices/board/drivers/integration-test",
  "//src/devices/board/drivers/machina",
  "//src/devices/bundles:bootstrap",
  "//src/devices/bus/drivers/pci:bus-pci",
  "//src/devices/bus/drivers/pci:bus-pci.proxy",
  "//src/devices/clock/bin/clock",
  "//src/devices/clock/bin/clock:clkctl",
  "//src/devices/clock/drivers/amlogic-clk",
  "//src/devices/cpu/bin/cpuctl",
  "//src/devices/cpu/drivers/aml-cpu",
  "//src/devices/gpio/bin/gpioutil",
  "//src/devices/gpio/drivers/aml-axg-gpio",
  "//src/devices/i2c/bin:i2cutil",
  "//src/devices/i2c/bin/i2c",
  "//src/devices/i2c/drivers/aml-i2c",
  "//src/devices/light-sensor/drivers/ams-light",
  "//src/devices/light-sensor/drivers/lite-on",
  "//src/devices/misc/drivers/cpu-trace",
  "//src/devices/nand/bin/nand-loader",
  "//src/devices/nand/bin/nand-util",
  "//src/devices/nand/drivers/aml-rawnand",
  "//src/devices/nand/drivers/broker:nand-broker",
  "//src/devices/nand/drivers/nand",
  "//src/devices/nand/drivers/nandpart",
  "//src/devices/nand/drivers/ram-nand",
  "//src/devices/nand/drivers/skip-block",
  "//src/devices/power/bin/lspwr",
  "//src/devices/power/drivers/aml-meson-power",
  "//src/devices/pwm/drivers/aml-pwm",
  "//src/devices/pwm/drivers/aml-pwm-init",
  "//src/devices/pwm/drivers/pwm",
  "//src/devices/ram/bin/ram-info",
  "//src/devices/ram/drivers/aml-ram",
  "//src/devices/rtc/drivers/fallback",
  "//src/devices/securemem/drivers/aml-securemem",
  "//src/devices/serial/drivers/aml-uart",
  "//src/devices/shareddma/drivers/syn-dma",
  "//src/devices/spi/bin/spiutil",
  "//src/devices/spi/drivers/aml-spi",
  "//src/devices/sysmem/drivers/sysmem",
  "//src/devices/tee/drivers/optee",
  "//src/devices/thermal/bin/thermal-cli",
  "//src/devices/usb/bin/usb-fwloader",
  "//src/devices/usb/bin/usbctl",
  "//src/devices/usb/drivers/aml-usb-phy-v2",
  "//src/devices/usb/drivers/dwc2",
  "//src/devices/usb/drivers/usb-peripheral",
  "//src/devices/usb/drivers/usb-peripheral-test",
  "//src/devices/usb/drivers/usb-test/fx3",
  "//src/devices/usb/drivers/usb-test/usb-tester",
  "//src/devices/usb/drivers/usb-virtual-bus",
  "//src/diagnostics/dlog",
  "//src/graphics/display/bin/display-test",
  "//src/graphics/display/drivers/aml-canvas",
  "//src/graphics/display/drivers/amlogic-display",
  "//src/graphics/display/drivers/display",
  "//src/graphics/display/drivers/dsi-dw",
  "//src/graphics/drivers/aml-gpu",
  "//src/media/audio/bin/ihda",
  "//src/media/audio/drivers/aml-g12-tdm",
  "//src/media/audio/drivers/astro-pdm-input",
  "//src/media/audio/drivers/codecs/tas27xx",
  "//src/media/audio/tools/audio-driver-ctl:bin",
  "//src/power/shutdown-shim:bootfs",
  "//src/security/bin/syscall-check",
  "//src/storage/bin/blobfs",
  "//src/storage/bin/dd",
  "//src/storage/bin/dd",
  "//src/storage/bin/df",
  "//src/storage/bin/disk-pave:install-disk-image",
  "//src/storage/bin/fsck:fsck",
  "//src/storage/bin/minfs",
  "//src/storage/bin/mkfs:mkfs",
  "//src/storage/bin/mount:mount",
  "//src/storage/bin/storage-metrics",
  "//src/storage/bin/umount:umount",
  "//src/storage/fshost",
  "//src/storage/fshost:bootfs",
  "//src/sys/bin/psutils:handles",
  "//src/sys/bin/psutils:kill",
  "//src/sys/bin/psutils:killall",
  "//src/sys/bin/psutils:kstats",
  "//src/sys/bin/psutils:memgraph",
  "//src/sys/bin/psutils:ps",
  "//src/sys/bin/psutils:signal",
  "//src/sys/bin/psutils:threads",
  "//src/sys/bin/psutils:top",
  "//src/sys/bin/psutils:vmaps",
  "//src/sys/bin/psutils:vmos",
  "//src/sys/bootstrap:root_manifests",
  "//src/sys/component_manager:bootfs",
  "//src/testing/runtests",
  "//src/ui/backlight/bin/backlight",
  "//src/ui/backlight/drivers/ti-lp8556",
  "//src/ui/input/bin/hid",
  "//src/ui/input/drivers/focaltech",
  "//src/ui/input/drivers/goodix",
  "//src/ui/input/drivers/hid",
  "//src/ui/input/drivers/hid-buttons",
  "//src/ui/input/drivers/hidctl",
  "//src/ui/light/drivers/aml-light",
  "//src/zircon/bin/kcounter",
  "//src/zircon/bin/kstress",
  "//src/zircon/bin/ktrace",
  "//src/zircon/bin/loadgen",
  "//src/zircon/testing/mutex_pi_exerciser",
  "//zircon/system/ulib/driver-info/app:driverinfo",
  "//zircon/third_party/dev/ethernet/e1000",
  "//zircon/third_party/uapp/dash",
  "//zircon/third_party/uapp/fsck-msdosfs",
  "//zircon/third_party/uapp/kilo",
  "//zircon/third_party/uapp/mkfs-msdosfs",
]

if (target_cpu == "arm64") {
  common_image_contents += [
    "//src/devices/board/drivers/astro",
    "//src/devices/usb/drivers/xhci-rewrite:xhci",
  ]
} else if (target_cpu == "x64") {
  common_image_contents += [ "//src/devices/bin/acpidump" ]
}
