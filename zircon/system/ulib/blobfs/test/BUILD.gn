# Copyright 2019 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

group("test") {
  testonly = true
  deps = [
    ":blobfs-integration",
    ":blobfs-unit",
  ]
}

test("blobfs-unit") {
  test_group = "fs"
  sources = [
    "allocated-extent-iterator-test.cpp",
    "allocator-test.cpp",
    "blob-cache-test.cpp",
    "compressor-test.cpp",
    "create-tests.cpp",
    "extent-reserver-test.cpp",
    "format-test.cpp",
    "get-allocated-regions-test.cpp",
    "journal-test.cpp",
    "node-populator-test.cpp",
    "node-reserver-test.cpp",
    "ring-buffer-test.cpp",
    "unbuffered-operations-builder-test.cpp",
    "utils.cpp",
    "vector-extent-iterator-test.cpp",
    "vmo-buffer-test.cpp",
    "writeback-test.cpp",
  ]
  deps = [
    "$zx/system/ulib/async-loop",
    "$zx/system/ulib/async-loop:async-loop-cpp",
    "$zx/system/ulib/blobfs",
    "$zx/system/ulib/block-client:fake-device",
    "$zx/system/ulib/fidl-utils",
    "$zx/system/ulib/zxtest",
    "$zx/third_party/ulib/safemath",
  ]
}

test("blobfs-host") {
  sources = [
    "host-test.cpp",
  ]
  deps = [
    "$zx/system/ulib/blobfs",
    "$zx/system/ulib/zxtest",
  ]
}

test("blobfs-integration") {
  test_group = "fs"
  sources = [
    "integration/blobfs_integration_test.cpp",
    "integration/blobfs_test.cpp",
    "integration/environment.cpp",
    "integration/integration_main.cpp",
  ]
  deps = [
    "$zx/system/fidl/fuchsia-device:c",
    "$zx/system/fidl/fuchsia-hardware-block:c",
    "$zx/system/fidl/fuchsia-io:c",
    "$zx/system/ulib/async-loop",
    "$zx/system/ulib/blobfs",
    "$zx/system/ulib/fs-management",
    "$zx/system/ulib/fs-test-utils",
    "$zx/system/ulib/fvm",
    "$zx/system/ulib/fzl",
    "$zx/system/ulib/memfs",
    "$zx/system/ulib/zxtest",
  ]
}
